<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.cloud.pt.approval.ApprovalDAO">
	<sql id="forPager">
		<if test="kind=='title'">AND TITLE LIKE CONCAT('%',#{search},'%')</if>
		<if test="kind=='contents'">AND CONTENTS LIKE CONCAT('%',#{search},'%')</if>
	</sql>
	
	<sql id="state">
		<if test="division=='proceeding'">AND STATE='진행중'</if>
		<if test="division=='complete'">AND STATE='완료'</if>
		<if test="division=='wating'">AND STATE='대기중'</if>
		<if test="division=='reject'">AND STATE='반려'</if>
	</sql>
	
	<sql id="category">
		<if test="division=='휴가신청'">AND CATEGORY='휴가신청서'</if>
		<if test="division=='지출신청'">AND CATEGORY='지출결의서'</if>
		<if test="division=='휴직신청'">AND CATEGORY='휴직신청서'</if>
	</sql>
	
	<!-- 1. count  -->
	<select id="getCount" parameterType="Pager" resultType="Long">
		SELECT COUNT(APPROVALNUM) FROM APPROVAL
		WHERE APPROVALNUM>0
		<include refid="state"></include>
		<include refid="forPager"></include>
	</select>
	
	<!-- 2. list -->
	<select id="getApprovalList" resultType="ApprovalVO" parameterType="Pager">
		SELECT APPROVALNUM,REGDATE,CATEGORY,TITLE,STATE FROM APPROVAL
		WHERE APPROVALNUM>0
		<include refid="state"></include>
		<include refid="forPager"></include>
		ORDER BY APPROVALNUM DESC LIMIT #{startRow},#{lastRow}
	</select>
	
	<!-- 3.직원목록 -->
	<select id="getAnnualLine" resultType="EmployeeVO">
		SELECT NAME,POSITION FROM EMPLOYEE ORDER BY EMPLOYEENUM
	</select>
	
	<!-- 결재등록 -->
	<insert id="setAdd" parameterType="ApprovalVO">
		INSERT INTO APPROVAL(CATEGORY,MIDDLE,LAST,NAME,CONTENTS,LEAVEKIND,USEDATE,STARTDATE,ENDDATE)
		VALUES(#{category},#{middle},#{last},#{name},#{contents},#{leaveKind},#{useDate},#{startDate},#{endDate})
	</insert>
	<!-- 결재자결재문서 리스 -->
	<select id="getApproverList" resultType="ApprovalVO" parameterType="Pager">
		SELECT APPROVALNUM,REGDATE,CATEGORY,TITLE,STATE FROM APPROVAL
		WHERE APPROVALNUM>0
		<include refid="category"></include>
		<include refid="forPager"></include>
		ORDER BY APPROVALNUM DESC LIMIT #{startRow},#{lastRow}
	</select>
</mapper>